{{$appSettings:= .InjectedData.AppSettings}}
{{$minPasswordLength := .InjectedData.Data.MinPasswordLength}}

<!DOCTYPE html>
<html>
	<head>
        <title>{{template "html_title_app_name" .}} | User Profile</title>

		{{template "html_head" .}}
	</head>
	<body>
		<!-- HEADER -->
		{{template "header-with-btns" .}}

		<main>
			<div class="container">
				<div class="row justify-content-center">
                    <div class="col-12 col-lg-8 col-xl-6" id="userProfile">
                        
                        <!-- hidden input to relay min length into Vue for validation -->
                        <input type="hidden" id="minPasswordLength" value="{{$minPasswordLength}}">

                        <!-- add/edit inputs are shown when user is viewing/editing or adding -->
                        <div class="card">
                            <div class="card-header">
                                <h5>User Profile</h5>
                                <div class="card-header-btn">
                                    <div class="dropdown">
                                        <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">Tasks</button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li>
                                                <button 
                                                    class="dropdown-item" 
                                                    type="button"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#modal-changePassword"
                                                    v-on:click="resetChangePasswordModalForm"
                                                    v-bind:disabled="!userData.Active"
                                                >
                                                    Change Password
                                                </button>
                                            </li>

                                            {{if $appSettings.Allow2FactorAuth}}
                                            <li>
                                                <button 
                                                    v-if="userData.TwoFactorAuthEnabled" 
                                                    class="dropdown-item" 
                                                    type="button"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#modal-deactivate2FA"
                                                >
                                                    Deactivate 2 Factor Auth.
                                                </button>
                                                <button 
                                                    v-else 
                                                    class="dropdown-item" 
                                                    type="button"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#modal-activate2FA"
                                                    v-on:click="reset2FAActivationModalForm"
                                                    v-bind:disabled="!userData.Active"
                                                >
                                                    Activate 2 Factor Auth.
                                                </button>
                                            </li>
                                            {{end}}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body"> 
                                <!-- basics, password, 2fa, logout -->
                                <section>
                                    <!-- basics -->
                                    <div class="form-group">
                                        <label>Username:</label>
                                        <input type="email" class="form-control text-lowercase" v-model="userData.Username" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>First Name:</label>
                                        <input type="text" class="form-control" v-model="userData.Fname" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>Last Name:</label>
                                        <input type="text" class="form-control" v-model="userData.Lname" readonly>
                                    </div>
                                </section>
                                <hr class="divider">

                                <!-- 2FA status -->
                                {{if $appSettings.Allow2FactorAuth}}
                                <section>
                                    <template v-if="userData.TwoFactorAuthEnabled">
                                        <div class="alert alert-primary mb-0">2 Factor Authentication is enabled for this user.</div>
                                    </template>

                                    {{if $appSettings.Force2FactorAuth}}
                                    <template v-else>
                                        <div class="alert alert-danger mb-0">2 Factor Authentication is required, but is not enabled for this user. This user will not be able to log in.</div>
                                    </template>
                                    {{else}}
                                    <template v-else>
                                        <div class="alert alert-warning mb-0">2 Factor Authentication is not enabled for this user. You should enable 2 Factor Authentication, from the Tasks menu, for improved security.</div>
                                    </template>
                                    {{end}}
                                </section>
                                {{end}}

                                <!-- users cannot manage their own permissions, only admins can. -->
                                
                                <div class="alert" v-show="msg.length > 0" v-bind:class="msgType" v-cloak>
                                    [[msg]]
                                </div>
                            </div> <!-- end .card-body-->
                        </div> <!-- end .card -->

                    </div>
				</div>
			</div>
        </main>
        
        <!-- modal to change a user's password -->
        {{template "user-change-password-modal" .}}

        <!-- activate 2 factor auth, show user qr code to scan and input for verification token -->
        {{template "user-activate-2fa-modal" .}}

        <!-- deactivate 2 factor auth, just show a confirmation modal -->
        {{template "user-deactivate-2fa-modal" .}}
        

		{{template "footer"}}
		{{template "html_scripts" .}}
	</body>
</html>